apiVersion: argoproj.io/v1alpha1
kind: CronWorkflow
metadata:
  name: parallel-cronjob-workflow-cron
  serviceaccount: 
spec:
  schedule: "* * * * *" # Set the schedule as per your needs
  workflowSpec:
    serviceAccountName: workflows-sa
    entrypoint: parallel-cronjobs
    templates:
    - name: parallel-cronjobs
      steps:
      - - name: generate
          template: get-parameters-and-generate-jobs
      - - name: run-cronjob
          template: run-bash-job
          arguments:
            parameters:
            - name: item
              value: "{{item}}"
          withParam: "{{steps.generate.outputs.result}}"
    - name: get-parameters-and-generate-jobs
      script:
        image: 750876142122.dkr.ecr.ap-northeast-2.amazonaws.com/pyhon:latest # Replace with the docker image you prepared
    - name: run-bash-job
      inputs:
        parameters:
        - name: item
      container:
        containerName: describe-ec2-resource
        image: 750876142122.dkr.ecr.ap-northeast-2.amazonaws.com/describe-ec2-resource:56662aa342f04f23fd0c1a49cd187c42dcdbc1b6 # replace with your bash image
        imagePullPolicy: IfNotPresent
        envFrom:
          - configMapRef:
              name: "{{inputs.parameters.item}}"
